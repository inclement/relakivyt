#:import Vector kivy.vector.Vector
#:import sqrt math.sqrt
#:import atan2 math.atan2
#:import sin math.sin
#:import cos math.cos
#:import tanh math.tanh

<GameLevel>:
    spaceship: spaceship
    BoxLayout:
        size_hint_y: None
        height: sp(30)
        pos_hint: {'top': 0.1}
        canvas:
            Color:
                rgba: 0, 1, 1, 0.5
            Rectangle:
                size: self.size
                pos: self.pos
        Label:
            text: 'naive v:' + str(spaceship.naive_velocity)
        Label:
            text: 'naive a:' + str(spaceship.acceleration)
        Label:
            text: 'naive s:' + str(spaceship.naive_speed)
        Label:
            text: 's:' + str(spaceship.speed)
        Label:
            text: 'v:' + str(spaceship.velocity)
        Label:
            text: 'angle:' + str(spaceship.direction)
    LorentzBackground:
    Spaceship:
        id: spaceship
        
<Spaceship>:
    size_hint: None, None
    pos_hint: {}

    direction: atan2(self.naive_velocity[1], self.naive_velocity[0])
    naive_speed: sqrt(sum([v**2 for v in self.naive_velocity]))
    speed: tanh(self.naive_speed)
    velocity: self.speed * Vector([cos(self.direction), sin(self.direction)])

    BoxLayout:
        canvas:
            Color:
                rgba: 0, 0, 1, 1
            Ellipse:
                pos: self.pos
                size: self.size
            Color:
                rgba: 0,1,0,1
            Ellipse
                pos: Vector(self.pos) + Vector(self.size)*0.2
                size: Vector(self.size) * 0.6
            Color:
                rgba: 1, 0, 0, 1
            Ellipse:
                pos: Vector(self.center) - Vector(self.size)/20.
                size: Vector(self.size) / 10.
            Color:
                rgb: 1, 0, 1
            Line:
                points: [self.center[0], self.center[1], self.center[0] + 0.2*root.speed*self.width*cos(root.direction), self.center[1] + 0.2*root.speed*self.height*sin(root.direction)]
                width: 2
            
                